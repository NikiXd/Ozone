&НаКлиенте
Процедура ВыбратьЭкспСотрудников(Команда)
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Если Диалог.Выбрать() Тогда
		Объект.ФайлЭкспСотрудников = Диалог.Каталог;	
	КонецЕсли
	
КонецПроцедуры

&НаКлиенте
Процедура ЭкспортСотрудников(Команда)
	
	ТабДок = Новый ТабличныйДокумент();
	
	ТабДок = ВзятиеСотрудниковДляЭкспорта();	
	
	Эксель = Новый COMОбъект("Excel.Application");
	Эксель.DisplayAlerts = Ложь;
	Книга = Эксель.WorkBooks.Add();
    Лист = Книга.Worksheets(1);

	Для Ии = 1 По ТабДок.ВысотаТаблицы Цикл
		
		Для Жж = 1 По ТабДок.ШиринаТаблицы Цикл	
			
			Лист.Cells(Ии, Жж).Value = ТабДок.Область("R"+Ии+"C"+Жж).Текст;	
			
		КонецЦикла;
		
	КонецЦикла;
	
	Дата = Формат(ТекущаяДата(), "ДФ=" "дд_ММ_гггг_чч_мм_сс" );
	
	Дата = СтрЗаменить(Дата,":","_");
	
    Книга.SaveAs(Объект.ФайлЭкспСотрудников+"\Сотрудники_" + Дата);     
	Книга.Close();
	Эксель.Quit();
    Эксель = 0;	
	Сообщить("Сотрудники экспортированы в:" + Объект.ФайлЭкспСотрудников + "\Сотрудники_" + Дата + ".xlsx");
	
КонецПроцедуры

&НаСервере
Функция ВзятиеСотрудниковДляЭкспорта()
		
	Запрос = Новый Запрос();
	
	Запрос.Текст = "ВЫБРАТЬ
	               |	Сотрудники.Фамилия,
	               |	Сотрудники.Имя,
	               |	Сотрудники.Логин,
	               |	Сотрудники.Пароль,
	               |	Сотрудники.Должность
	               |ИЗ
	               |	Справочник.Сотрудники КАК Сотрудники";
					
	РезультатЗапроса = Запрос.Выполнить();
	
	СпособОбхода = ОбходРезультатаЗапроса.Прямой;
	ТабЗнач = РезультатЗапроса.Выгрузить(СпособОбхода);
		
	ТабДок = Новый ТабличныйДокумент();
	
	Макет = Обработки.ИмпортИЭкспорт.ПолучитьМакет("МакетЭкспортаСотрудиков");
	
	Область = Макет.ПолучитьОбласть("Шапка");
	
	ТабДок.Вывести(Область);
	
	Для Ии = 0 По ТабЗнач.Количество()-1 Цикл
		
		Строка = ТабЗнач.Получить(Ии);
		
		Область = Макет.ПолучитьОбласть("Строка");
		
		Область.Параметры.Фамилия =  Строка.Фамилия;
		Область.Параметры.Имя = Строка.Имя;
		Область.Параметры.Логин = Строка.Логин;
		Область.Параметры.Пароль = Строка.Пароль;
		Область.Параметры.Должность = Строка.Должность;
		
		ТабДок.Вывести(Область);
		
	КонецЦикла;
	
	Возврат(ТабДок);
	
КонецФункции
